<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification to HOD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: rgb(191, 223, 252);
        }

        .navbar {
            background-color: #007bff;
        }

        .navbar-brand {
            color: white !important;
        }

        .nav-link {
            color: white !important;
        }

        .nav-link:hover {
            color: #f0f0f0 !important;
        }

        .dashboard {
            margin-top: 20px;
        }

        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-heading {
            margin-bottom: 20px;
        }

        .btn-send {
            background-color: #007bff;
            color: white;
        }

        .btn-send:hover {
            background-color: #0056b3;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 10px;
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">Discipline360</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Notifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="logout" href="#">Log Out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="container dashboard">
        <div class="row">
            <!-- Sidebar (optional, can be extended) -->
            <div class="col-md-3">
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active">Student Details</a>
                    <a href="#" class="list-group-item list-group-item-action">Misbehavior Log</a>
                    <a href="#" class="list-group-item list-group-item-action">Reports</a>
                    <a href="#" class="list-group-item list-group-item-action">Settings</a>
                </div>
            </div>

            <!-- Main Content Area -->

            <div class="col-md-9" id="notificationForm">
                <div class="form-section">
                    <h3 class="form-heading">Notify HOD - Enter Student Details</h3>
                    <form id="notificationForm"> <!-- Added form id -->
                        <div class="mb-3">
                            <label for="studentName" class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="studentName" placeholder="Enter Student Name"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="studentRollNo" class="form-label">Roll Number</label>
                            <input type="text" class="form-control" id="rollNo" placeholder="Enter Roll Number"
                                required>
                            </div>
                            <div class="mb-3">
                                <label for="placeOfMisbehavior" class="form-label">Branch</label>
                                <input type="text" class="form-control" id="placeOfMisbehavior" placeholder="Enter Location"
                                    required>
                            </div>

                        <div class="mb-3">
                            <label for="incidentDate" class="form-label">Date of Misbehavior</label>
                            <input type="date" class="form-control" id="incidentDate" required>
                        </div>

                        <div class="mb-3">
                            <label for="misbehaviorDetails" class="form-label">Details of Misbehavior and Place</label>
                            <textarea class="form-control" id="misbehaviorDetails" rows="4"
                                placeholder="Enter the details" required></textarea>
                        </div>

<br>
                        <!-- Button to send notification -->
                        <button type="submit" class="btn btn-send">Send Notification to HOD</button>
                        <br>
                    </form>
                </div>
            </div>


            <!-- Footer -->
            <footer>
                <p>&copy; 2024 Discipline360 - Student Behavior Management System</p>
            </footer>

            <!-- EmailJS and Script -->
            <script type="text/javascript"
                src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
            <script type="text/javascript">
                (function () {
                    emailjs.init("XPva953fR_Geno8za");
                })();
            </script>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const notificationForm = document.getElementById("notificationForm");

                    if (notificationForm) {
                        notificationForm.addEventListener("submit", function (event) {
                            event.preventDefault();

                            // Gather data from the form fields (misbehavior incident details)
                            const studentName = document.getElementById("studentName").value;
                            const rollNo = document.getElementById("rollNo").value;
                            const placeOfMisbehavior = document.getElementById("placeOfMisbehavior").value;
                            const misbehaviorDetails = document.getElementById("misbehaviorDetails").value;
                            const incidentDate = document.getElementById("incidentDate").value;

                            // Get the current system time
                            const currentTime = new Date();
                            const formattedTime = currentTime.toLocaleTimeString(); // Formats as 'hh:mm:ss AM/PM'

                            console.log({ studentName, rollNo, placeOfMisbehavior, misbehaviorDetails, incidentDate, formattedTime });

                            // Sending email notification to HOD
                            emailjs
                                .send("service_7gt04xb", "template_1rfn2av", {
                                    student_name: studentName,
                                    roll_no: rollNo,
                                    place_of_misbehavior: placeOfMisbehavior,
                                    misbehavior_details: misbehaviorDetails,
                                    incident_date: incidentDate,
                                    incident_time: formattedTime, // Pass the current time to the template
                                    to_email: "shivanshusrivastava440@gmail.com", // Dynamically set HOD's email here
                                    subject: `Misbehavior Alert for Student: ${studentName}`, // Email subject
                                })
                                .then(function (response) {
                                    console.log("Notification SUCCESS!", response.status, response.text);
                                    alert("Notification sent successfully to the HOD! âœ…");

                                    // Reset the form after success
                                    notificationForm.reset();
                                })
                                .catch(function (error) {
                                    console.error("Notification FAILED...", error);
                                    alert("Failed to send notification!");

                                    notificationForm.reset();
                                });

                        });
                    } else {
                        console.error("Form not found in the DOM!");
                    }
                });

   // Function to handle logout
   document.getElementById('logout').addEventListener('click', function(event) {
        event.preventDefault();
        if (confirm('Are you sure you want to logout?')) {
            // Clear token from sessionStorage
            sessionStorage.removeItem('token');
            // Redirect to login page
            window.location.href = 'index.html';
        }
    });


            </script>



            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>